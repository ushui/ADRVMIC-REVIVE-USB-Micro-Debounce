# ADRVMIC よくある質問

## USB接続の製品の場合には、下記の点についてお確かめください。

 - 使用しているケーブルがデータ通信可能であるか。
   - 電力供給のみのケーブルであることが多々ございます
 - ブートスイッチ等、ファームウェア書き込みモードになっていないか。
   - 説明書にブートスイッチについての記載がある製品が対象です
 - USBポートから十分な電力が供給されているか。
   - 念の為、PC本体のマザーボード側USBコネクタでお確かめください
 - 同時に接続している機器が干渉していないか。
   - できる限り最小構成での試行をお願い致します

----

## Q: 作成したデバイスは別のPCでも使用できますか

### A: 可能です。一度設定したボタンマッピングはデバイスに保存されるため他のPCに接続しても同様に動作します。

----

## Q: 設定ツールからボードが認識されません。

### A: 旧版REVIVE用の設定ツールを利用していないかご確認ください。
新REVIVE Microの設定ツールは[こちら](https://github.com/bit-trade-one/ADRVMIC-REVIVE-USB-Micro/tree/master/App)からダウンロードできます。

----

## Q: 設定ツールでUpdateボタンを押すとボードが認識されなくなった

### A:  Updateボタンをクリックしますと、REVIVEの動作はファームウェアアップデートモードに移行します。
この状態では通常の機能が使用できませんのでご注意下さい。  
通常動作に戻す場合は一度USBでの接続を取り外し、再度接続することで通常動作モードにてREVIVEが動作します。 

----

## Q: マトリックス配線で同時押しが正常に動作しない

### A: 単体での入力に問題が見られない場合、REVIVE自体は問題なく動作していると考えられます。 

スイッチ周辺の結線に短絡や断線がないか、また同時押し用ダイオードを入れている場合はその周辺に問題がないか、ご確認くださいませ。 

----

## Q: 何も接続していないピンを残して大丈夫でしょうか

### A: プルアップされているため特に設定などは必要ありません。絶縁のみ、お気を付けください。

----

## Q: LED内蔵の照光式押ボタンを使用したい

### A: ボタンを押している間点灯する回路として、図のように接続してください。

![](https://bit-trade-one.co.jp/wp/wp-content/uploads/2020/09/signed-url-redirect.png)

なお、恐れ入りますが抵抗Rの値につきましてはスイッチの仕様に合わせた値を選定くださいませ。  
また、動作の保証は致しかねますことご了承ください。

----

# 対策版 よくある質問

## Q: 対策版の設定ツールを起動したらエラーが発生してしまいました。
### A: 公式設定ツールのUpdateボタンから対策版ファームウェアに更新後、対策版設定ツールを起動してください。
公式ファームウェアを適用している状態で対策版設定ツールを使用すると、エラーが発生する場合があります（EEPROMに書き込まれている内部的な設定値によるため、発生しない場合もあります）。  
基本的には適用しているファームウェアに対応した設定ツールを使用することをおすすめします。  
もし対策版ファームウェアを適用している状態で対策版設定ツールでエラーが発生した場合は、[Twitter](https://twitter.com/kaede_hrc)までご連絡ください。  

## Q: 対策版を適用してもチャタリングが発生してしまいました。
### A: サンプリング周期または一致検出回数を変更することでチャタリング対策を強化できます。
ひとまず設定値を以下に変更してください。  
 - チャタリング防止設定：サンプリング周期=10ms、一致検出回数=3回
 - ロータリーエンコーダ設定：一致検出回数=2回
 
それでも改善しない場合は、さらに数値を増やして適正値を見つけてください。  
あまりに酷いようであれば、スイッチの接続に問題があるかスイッチの故障を疑ってください。  

## Q: ロータリーエンコーダを接続しましたが、動作しません。
### A: インクリメンタル形のA相/B相があるロータリーエンコーダにのみ対応しています。アブソリュート形には対応していません。
インクリメンタル形のロータリーエンコーダを使用している場合は以下を確認してください。  
 - 1相タイプ：B相がないタイプです。対応していません。
 - 2相タイプ：A相/B相の接続先が正しいピンになっていること、接続したピンにチェックを付けて設定していることを確認してください。
  A相は1ピン、B相は2ピンというように、必ず隣り合ったピンに接続する必要があります。
 - 3相タイプ：Z相には対応していないため、A相/B相のみ接続してください。

使用する方が多いかもしれませんので特記しますが、EC12E2430803やRES20D-50-201-1は2相タイプですので使用できます。

## Q: 遅延を最小限にする設定をしたいのですが、どうすればよいですか？
### A: チャタリング防止設定（＋ロータリーエンコーダ設定の一致検出回数）の値をすべて1に設定してください。
チャタリング防止機能を無効化できます。  

## Q: サンプリング周期と一致検出回数のデフォルト値の根拠は何ですか？
### A: 実体験に基づいたフィーリングです。
後者の設定で賄えるパターンが実はほとんどなのでは？　と感じたので、もしもこの設定でチャタリングが起きたならば設定値を変えてもらおうという思想で作りました。  
参考までに設定値の決め方は以下です。  

#### デジタル入力
対策版ファームウェアを使用した個人的な経験では、マイクロスイッチ使用時にはサンプリング周期=3ms(一致検出回数=1回)もしくは2ms(2回)からチャタリングが起こらなくなります。  
チャタリングの確認方法は、適当なキーボード入力にしておき、何度もスイッチを押してみて、キーを1回しか入力していないのに2回入力されることがあるか、という方法です。  
経験に基づき、スイッチの劣化も考慮すると4ms(2回)くらいにしておけばいいかな、という感覚で設定しました。  

一般的にマイクロスイッチのチャタリング時間には1～10msの幅があると言われています。  
4ms(2回)の設定ならチャタリング時間=8msまでカバーできるため、おおよそこの程度で間違いはないと思います。  

#### デジタル入力(ロータリーエンコーダ)
サンプリング周期は上記項目に依存するため、一致検出回数について記載します。  
個人的な経験では一致検出回数=2回までは入力を受け取ってくれるのですが、3回以上に設定していくと徐々に反応しなくなってきます。  
これはロータリーエンコーダはマイクロスイッチ等よりもパルス出力が安定しないことによるものなので、あえて無効（=1回）にしています。  
